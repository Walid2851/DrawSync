{"ast":null,"code":"import { create } from 'zustand';\nimport { persist } from 'zustand/middleware';\nimport { authAPI } from '../utils/api';\nconst useAuthStore = create(persist((set, get) => ({\n  user: null,\n  token: null,\n  isAuthenticated: false,\n  isLoading: false,\n  error: null,\n  // Login user\n  login: async credentials => {\n    console.log('AuthStore: Starting login process');\n    set({\n      isLoading: true,\n      error: null\n    });\n    try {\n      console.log('AuthStore: Making login API call');\n      const response = await authAPI.login(credentials);\n      console.log('AuthStore: Login API response:', response.data);\n      const {\n        access_token\n      } = response.data;\n\n      // Store token in localStorage first\n      localStorage.setItem('token', access_token);\n      console.log('AuthStore: Token stored in localStorage');\n\n      // Get user info using the token\n      console.log('AuthStore: Getting current user info');\n      const userResponse = await authAPI.getCurrentUser();\n      console.log('AuthStore: User info response:', userResponse.data);\n      const user = userResponse.data;\n      set({\n        user,\n        token: access_token,\n        isAuthenticated: true,\n        isLoading: false,\n        error: null\n      });\n      console.log('AuthStore: State updated successfully');\n\n      // Store user in localStorage\n      localStorage.setItem('user', JSON.stringify(user));\n      console.log('AuthStore: User stored in localStorage');\n      return {\n        success: true\n      };\n    } catch (error) {\n      var _error$response, _error$response$data;\n      console.error('AuthStore: Login error:', error);\n      const errorMessage = ((_error$response = error.response) === null || _error$response === void 0 ? void 0 : (_error$response$data = _error$response.data) === null || _error$response$data === void 0 ? void 0 : _error$response$data.detail) || 'Login failed';\n      set({\n        isLoading: false,\n        error: errorMessage\n      });\n      return {\n        success: false,\n        error: errorMessage\n      };\n    }\n  },\n  // Register user\n  register: async userData => {\n    set({\n      isLoading: true,\n      error: null\n    });\n    try {\n      const response = await authAPI.register(userData);\n      const user = response.data;\n\n      // For registration, we need to login to get the token\n      const loginResponse = await authAPI.login({\n        username: userData.username,\n        password: userData.password\n      });\n      const {\n        access_token\n      } = loginResponse.data;\n\n      // Store token in localStorage first\n      localStorage.setItem('token', access_token);\n      set({\n        user,\n        token: access_token,\n        isAuthenticated: true,\n        isLoading: false,\n        error: null\n      });\n\n      // Store user in localStorage\n      localStorage.setItem('user', JSON.stringify(user));\n      return {\n        success: true\n      };\n    } catch (error) {\n      var _error$response2, _error$response2$data;\n      const errorMessage = ((_error$response2 = error.response) === null || _error$response2 === void 0 ? void 0 : (_error$response2$data = _error$response2.data) === null || _error$response2$data === void 0 ? void 0 : _error$response2$data.detail) || 'Registration failed';\n      set({\n        isLoading: false,\n        error: errorMessage\n      });\n      return {\n        success: false,\n        error: errorMessage\n      };\n    }\n  },\n  // Logout user\n  logout: () => {\n    localStorage.removeItem('token');\n    localStorage.removeItem('user');\n    set({\n      user: null,\n      token: null,\n      isAuthenticated: false,\n      isLoading: false,\n      error: null\n    });\n  },\n  // Initialize auth state from localStorage\n  initializeAuth: async () => {\n    const token = localStorage.getItem('token');\n    const user = localStorage.getItem('user');\n    if (token && user) {\n      try {\n        const userData = JSON.parse(user);\n        set({\n          user: userData,\n          token,\n          isAuthenticated: true\n        });\n\n        // Verify token is still valid\n        await authAPI.getCurrentUser();\n      } catch (error) {\n        // Token is invalid, clear auth state\n        get().logout();\n      }\n    }\n  },\n  // Clear error\n  clearError: () => {\n    set({\n      error: null\n    });\n  },\n  // Update user data\n  updateUser: userData => {\n    set({\n      user: userData\n    });\n    localStorage.setItem('user', JSON.stringify(userData));\n  }\n}), {\n  name: 'auth-storage',\n  partialize: state => ({\n    user: state.user,\n    token: state.token,\n    isAuthenticated: state.isAuthenticated\n  })\n}));\nexport default useAuthStore;","map":{"version":3,"names":["create","persist","authAPI","useAuthStore","set","get","user","token","isAuthenticated","isLoading","error","login","credentials","console","log","response","data","access_token","localStorage","setItem","userResponse","getCurrentUser","JSON","stringify","success","_error$response","_error$response$data","errorMessage","detail","register","userData","loginResponse","username","password","_error$response2","_error$response2$data","logout","removeItem","initializeAuth","getItem","parse","clearError","updateUser","name","partialize","state"],"sources":["/Users/walid/Documents/Networking/drawsync/frontend/src/store/authStore.js"],"sourcesContent":["import { create } from 'zustand';\nimport { persist } from 'zustand/middleware';\nimport { authAPI } from '../utils/api';\n\nconst useAuthStore = create(\n  persist(\n    (set, get) => ({\n      user: null,\n      token: null,\n      isAuthenticated: false,\n      isLoading: false,\n      error: null,\n\n      // Login user\n      login: async (credentials) => {\n        console.log('AuthStore: Starting login process');\n        set({ isLoading: true, error: null });\n        try {\n          console.log('AuthStore: Making login API call');\n          const response = await authAPI.login(credentials);\n          console.log('AuthStore: Login API response:', response.data);\n          const { access_token } = response.data;\n          \n          // Store token in localStorage first\n          localStorage.setItem('token', access_token);\n          console.log('AuthStore: Token stored in localStorage');\n          \n          // Get user info using the token\n          console.log('AuthStore: Getting current user info');\n          const userResponse = await authAPI.getCurrentUser();\n          console.log('AuthStore: User info response:', userResponse.data);\n          const user = userResponse.data;\n          \n          set({\n            user,\n            token: access_token,\n            isAuthenticated: true,\n            isLoading: false,\n            error: null,\n          });\n          console.log('AuthStore: State updated successfully');\n\n          // Store user in localStorage\n          localStorage.setItem('user', JSON.stringify(user));\n          console.log('AuthStore: User stored in localStorage');\n          \n          return { success: true };\n        } catch (error) {\n          console.error('AuthStore: Login error:', error);\n          const errorMessage = error.response?.data?.detail || 'Login failed';\n          set({\n            isLoading: false,\n            error: errorMessage,\n          });\n          return { success: false, error: errorMessage };\n        }\n      },\n\n      // Register user\n      register: async (userData) => {\n        set({ isLoading: true, error: null });\n        try {\n          const response = await authAPI.register(userData);\n          const user = response.data;\n          \n          // For registration, we need to login to get the token\n          const loginResponse = await authAPI.login({\n            username: userData.username,\n            password: userData.password\n          });\n          const { access_token } = loginResponse.data;\n          \n          // Store token in localStorage first\n          localStorage.setItem('token', access_token);\n          \n          set({\n            user,\n            token: access_token,\n            isAuthenticated: true,\n            isLoading: false,\n            error: null,\n          });\n\n          // Store user in localStorage\n          localStorage.setItem('user', JSON.stringify(user));\n          \n          return { success: true };\n        } catch (error) {\n          const errorMessage = error.response?.data?.detail || 'Registration failed';\n          set({\n            isLoading: false,\n            error: errorMessage,\n          });\n          return { success: false, error: errorMessage };\n        }\n      },\n\n      // Logout user\n      logout: () => {\n        localStorage.removeItem('token');\n        localStorage.removeItem('user');\n        set({\n          user: null,\n          token: null,\n          isAuthenticated: false,\n          isLoading: false,\n          error: null,\n        });\n      },\n\n      // Initialize auth state from localStorage\n      initializeAuth: async () => {\n        const token = localStorage.getItem('token');\n        const user = localStorage.getItem('user');\n\n        if (token && user) {\n          try {\n            const userData = JSON.parse(user);\n            set({\n              user: userData,\n              token,\n              isAuthenticated: true,\n            });\n\n            // Verify token is still valid\n            await authAPI.getCurrentUser();\n          } catch (error) {\n            // Token is invalid, clear auth state\n            get().logout();\n          }\n        }\n      },\n\n      // Clear error\n      clearError: () => {\n        set({ error: null });\n      },\n\n      // Update user data\n      updateUser: (userData) => {\n        set({ user: userData });\n        localStorage.setItem('user', JSON.stringify(userData));\n      },\n    }),\n    {\n      name: 'auth-storage',\n      partialize: (state) => ({\n        user: state.user,\n        token: state.token,\n        isAuthenticated: state.isAuthenticated,\n      }),\n    }\n  )\n);\n\nexport default useAuthStore; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}